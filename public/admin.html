<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Portal - UFL Christmas Spinner</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="admin-page">
    <!-- Admin Login Overlay -->
    <div id="adminLoginOverlay" class="overlay hidden">
        <div class="result-card" style="max-width:420px;">
            <h2 style="margin-top:0;">Admin Sign In</h2>
            <p style="color:#666; font-size:13px;">Enter your admin credentials to access the portal.</p>
            <div style="margin-top:12px;">
                <div class="form-group">
                    <label for="adminUsername">Username</label>
                    <input id="adminUsername" type="text" placeholder="Username" style="width:100%; padding:8px; border-radius:6px; border:1px solid #ddd;">
                </div>
                <div class="form-group">
                    <label for="adminPassword">Password</label>
                    <input id="adminPassword" type="password" placeholder="Password" style="width:100%; padding:8px; border-radius:6px; border:1px solid #ddd;">
                </div>
                <p id="adminLoginError" style="color:#c41e3a; font-size:13px; display:none;"></p>
                <div style="display:flex; gap:10px; margin-top:12px;">
                    <button id="adminLoginBtn" class="btn-primary" style="flex:1;" onclick="adminAttemptLogin()">Sign In</button>
                    <button id="adminLogoutForceBtn" class="btn-upload" style="background:#c41e3a; display:none;">Force Logout</button>
                </div>
            </div>
        </div>
    </div>
    <div class="admin-container">
        <header class="admin-header">
            <h1>ðŸŽ„ UFL Christmas Secret Santa - Admin Portal ðŸŽ…</h1>
            <div style="margin-top:15px; display:flex; gap:10px; align-items:center;">
                <button onclick="window.location.href='validation.html'" style="padding: 10px 20px; background: white; color: #c41e3a; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-family: Georgia, serif;">ðŸ“Š End-to-End Validation</button>
                <button id="forceReloginBtn" onclick="broadcastRequireAdminLogin()" style="padding:10px 18px; background:#ff6b6b; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold;">ðŸ”’ Force Admin Re-login</button>
                <button id="adminLogoutBtn" onclick="adminLogout()" style="padding:10px 18px; background:#666; color:white; border:none; border-radius:8px; cursor:pointer; font-weight:bold;">âŽ‹ Logout</button>
            </div>
        </header>

        <!-- Stats Section -->
        <div class="stats-container">
            <div class="stat-card">
                <h3>Total Staff</h3>
                <p class="stat-number" id="totalStaff">0</p>
            </div>
            <div class="stat-card">
                <h3>Spins Completed</h3>
                <p class="stat-number" id="spunCount">0</p>
            </div>
            <div class="stat-card">
                <h3>Gifts Shared</h3>
                <p class="stat-number" id="giftsShared">0</p>
            </div>
            <div class="stat-card">
                <h3>Remaining</h3>
                <p class="stat-number" id="remaining">0</p>
            </div>
        </div>

        <!-- Upload Staff Data & Generate One-Time ID Section -->
        <div class="upload-section">
            <div class="section-header" onclick="toggleStaffManagementSection()">
                <h2>ðŸ“¤ Staff Management (Upload & Generate ID)</h2>
                <span class="collapse-icon" id="staffManagementCollapseIcon">â–¼</span>
            </div>
            <div class="upload-content" id="staffManagementContent">
                <!-- Upload Subsection -->
                <div style="margin-bottom: 30px; padding-bottom: 20px; border-bottom: 2px solid #ddd;">
                    <h3 style="margin-bottom: 15px; color: #333;">Upload Staff Data</h3>
                    <div class="upload-grid">
                        <div class="upload-card">
                            <h3>Dairies Plant Staff</h3>
                            <input type="file" id="dairiesFile" accept=".xlsx,.xls" class="file-input">
                            <button onclick="uploadFile('dairies')" class="btn-upload">Upload Dairies</button>
                        </div>
                        <div class="upload-card">
                            <h3>Swan Plant Staff</h3>
                            <input type="file" id="swanFile" accept=".xlsx,.xls" class="file-input">
                            <button onclick="uploadFile('swan')" class="btn-upload">Upload Swan</button>
                        </div>
                        <div class="upload-card">
                            <h3>Snacks Plant Group 1</h3>
                            <input type="file" id="snacks1File" accept=".xlsx,.xls" class="file-input">
                            <button onclick="uploadFile('snacks1')" class="btn-upload">Upload Snacks 1</button>
                        </div>
                        <div class="upload-card">
                            <h3>Snacks Plant Group 2</h3>
                            <input type="file" id="snacks2File" accept=".xlsx,.xls" class="file-input">
                            <button onclick="uploadFile('snacks2')" class="btn-upload">Upload Snacks 2</button>
                        </div>
                    </div>
                    <p id="uploadMessage" class="upload-message"></p>
                </div>

                <!-- Generate One-Time ID Subsection -->
                <div>
                    <h3 style="margin-bottom: 15px; color: #333;">Generate One-Time ID (for staff without Employee ID)</h3>
                    <div style="max-width: 500px;">
                        <div class="form-group">
                            <label for="staffNameInput">Staff Name</label>
                            <input type="text" id="staffNameInput" placeholder="Enter staff name..." class="file-input">
                        </div>
                        <div class="form-group">
                            <label for="staffDepartmentInput">Department</label>
                            <input type="text" id="staffDepartmentInput" placeholder="Enter department..." class="file-input">
                        </div>
                        <div class="form-group">
                            <label for="staffGroupSelect">Group</label>
                            <select id="staffGroupSelect" class="file-input">
                                <option value="">Select group</option>
                                <option value="dairies">Dairies Plant</option>
                                <option value="swan">Swan Plant</option>
                                <option value="snacks1">Snacks Group 1</option>
                                <option value="snacks2">Snacks Group 2</option>
                            </select>
                        </div>
                        <button onclick="generateOneTimeId()" class="btn-upload" style="background: #16a34a;">Generate ID</button>
                    </div>
                    <p id="generateIdMessage" class="upload-message"></p>
                    <div id="generatedIdCard" style="display: none; background: #f0fdf4; border: 2px solid #16a34a; border-radius: 10px; padding: 20px; margin-top: 20px; text-align: center;">
                        <p style="margin: 0 0 10px 0; color: #666; font-size: 12px;">One-Time ID:</p>
                        <p id="generatedIdDisplay" style="margin: 0; font-size: 24px; font-weight: bold; color: #16a34a; font-family: monospace; letter-spacing: 2px;"></p>
                        <p style="margin: 10px 0 0 0; color: #666; font-size: 11px;">Share this ID with the staff member. Valid for one login only.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Staff Table Section -->
        <div class="table-section">
            <h2>ðŸ“‹ Spin Records</h2>
            <div style="margin-bottom: 20px;">
                <input type="text" id="searchInput" placeholder="Search by Name of Spinner or Name Spun..." 
                       style="width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-family: Georgia, serif; font-size: 13px;">
            </div>
            <div class="table-container">
                <table class="staff-table">
                    <thead>
                        <tr>
                            <th>S/N</th>
                            <th>Name of Spinner</th>
                            <th>Department of Name of Spinner</th>
                            <th>Name Spun</th>
                            <th>Department of Name Spun</th>
                            <th>Group</th>
                            <th>Gift Shared Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="staffTableBody">
                        <tr>
                            <td colspan="6" class="no-data">No spin records yet</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination">
                <button id="prevBtn" class="pagination-btn" onclick="changePage(-1)">Previous</button>
                <span id="pageInfo" class="page-info">Page 1 of 1</span>
                <button id="nextBtn" class="pagination-btn" onclick="changePage(1)">Next</button>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        // Ensure socket.io client is available for admin real-time updates
        try { window.__io = io(); } catch (e) { console.warn('Socket.IO client not available'); }
    </script>
    <script src="admin.js"></script>
</body>
</html>